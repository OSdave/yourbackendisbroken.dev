#!/bin/bash

git checkout step-1
clear
cat .tutorial/banners/webspicy.txt

echo "Waiting for API to start..."
timeout 10 bash -c 'until printf "" 2>>/dev/null >>/dev/tcp/$0/$1; do sleep 1; done' localhost 3000

if [ $? -gt 0 ]; then
  echo "API unreachable ..."
  exit
fi

clear
cat .tutorial/banners/webspicy.txt

# Check wether or not we have a docker volume mounted
HAS_VOLUME_MOUNTED=false
if [ "$DOCKER_ENV" == 1 ]; then
  df -h | grep /ybib > /dev/null 2>&1
  if [ $? == 0 ]; then
    HAS_VOLUME_MOUNTED=true
  fi;
fi

cat <<-EOF
Welcome to this tutorial!

The API is running on http://localhost:3000 and you'll find its
logs in /tmp/api.logs

EOF

if [ "$HAS_VOLUME_MOUNTED" == true ]; then
cat <<-EOF
You will find the source code used in this tutorial
in $YBIB_PWD.

EOF
fi

if [ -z "$GITPOD_REPO_ROOT" ]; then
cat <<-EOF
Go back to your browser, you are ready for "Step 1" of the tutorial.
https://yourbackendisbroken.dev/tutorial/step-1.html

EOF
else
cat <<-EOF
To make it easier we've already opened the tutorial in the right panel,
but you might need to resize it.

EOF
fi
