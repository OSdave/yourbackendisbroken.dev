#!/bin/bash

LAST_STEP=`git tag -l | grep step- | sort | tail -n 1`
LAST_STEP_NUMBER=`echo $LAST_STEP | cut -d'-' -f2`

if [ ! $# -eq 1 ]; then
  echo "Usage $0 N where 1 <= N <= $STEP_MAX"
  exit
fi

STEP=$1
if [ $STEP -gt $LAST_STEP_NUMBER ]; then
  echo "We only have $LAST_STEP_NUMBER steps"
  exit
fi

if [ $STEP -lt 1 ]; then
  echo "The tutorial only starts at step 1 ;)"
  exit
fi

git reset --hard HEAD > /dev/null 2>&1
git checkout step-$STEP > /dev/null 2>&1

clear

# Banner for current (new) step
CURRENT_STEP=`git describe --tags`
bash .tutorial/banners/step-$STEP.sh

# Run step script if gitpod env
if [ ! -z $GITPOD_REPO_ROOT ]; then
  if [ -e .tutorial/gitpod-steps/$CURRENT_STEP.sh ]; then
    .tutorial/gitpod-steps/$CURRENT_STEP.sh
  fi
fi
